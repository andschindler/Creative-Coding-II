<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktive AR Musik-Loops</title>

    <!-- A-Frame und WebXR einbinden -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-webxr-component@2.1.0/dist/aframe-webxr-component.min.js"></script>
    
    <!-- Web-Room (WebSockets) einbinden -->
    <script src="https://cdn.jsdelivr.net/npm/web-rooms-client@1.3.0/dist/web-rooms-client.min.js"></script>
    
    <style>
      body { margin: 0; overflow: hidden; }
      .instrument { cursor: pointer; }
      .active { color: #FFD700; }
    </style>
  </head>

  <body>
    <a-scene xrweb="tracking: true; environment: true;" embedded>

      <!-- Web-Room Verbindungssetup -->
      <script>
        const socket = new WebSocket('ws://localhost:8080');  // WebSocket-Verbindung zum Web-Room
        const instruments = [];
        let audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        socket.onopen = () => {
          console.log("WebSocket verbunden");
        };

        // Instrumente
        const sounds = [
          { name: 'drums', file: 'drums.mp3', loop: true },
          { name: 'bass', file: 'bass.mp3', loop: true },
          { name: 'melody', file: 'melody.mp3', loop: true }
        ];

        // Funktion, um ein Instrument zu aktivieren oder zu deaktivieren
        function toggleInstrument(instrumentName) {
          const instrument = instruments.find(instr => instr.name === instrumentName);
          if (instrument.isActive) {
            instrument.sound.stop();
            instrument.isActive = false;
            document.getElementById(instrumentName).classList.remove('active');
          } else {
            instrument.sound.play();
            instrument.isActive = true;
            document.getElementById(instrumentName).classList.add('active');
          }
        }

        // Audio-Setup
        sounds.forEach(sound => {
          const audio = new Audio(sound.file);
          audio.loop = sound.loop;
          const source = audioContext.createMediaElementSource(audio);
          source.connect(audioContext.destination);

          instruments.push({
            name: sound.name,
            sound: audio,
            isActive: false
          });
        });

        // Interaktive Elemente (Musikinstrumente)
        sounds.forEach((sound, index) => {
          const element = document.createElement('a-box');
          element.setAttribute('id', sound.name);
          element.setAttribute('position', `${index * 2} 1.5 -3`);
          element.setAttribute('color', '#4CC3D9');
          element.setAttribute('scale', '1 1 1');
          element.setAttribute('class', 'instrument');
          element.setAttribute('touchstart', `toggleInstrument('${sound.name}')`);
          element.setAttribute('click', `toggleInstrument('${sound.name}')`);
          document.querySelector('a-scene').appendChild(element);
        });
      </script>

      <!-- Kameraperspektive -->
      <a-camera></a-camera>
    </a-scene>
  </body>
</html>
